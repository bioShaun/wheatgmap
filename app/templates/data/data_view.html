{% extends 'base.html' %} {% block content %}
<div class="title" style="margin-bottom: 30px">
  <h3>{{data.sample_name}}</h3>
  <p>ID: {{ data.tc_id }}, created at {{data.create_time}}</p>
</div>

<div class="va-img-display" id="va-img-display" imgDb="data">
  <div
    class="img-set-example"
    figId="{{exampleFig.id}}"
    figNum="{{leftFigNum}}"
  >
    <div>
      <a href="{{exampleFig.url}}" data-lightbox="sample-img">
        <img class="va-img" src="{{exampleFig.url}}" />
      </a>
    </div>
    <div>
      <button
        figId="{{exampleFig.id}}"
        class="delete-img-btn btn btn-danger btn-xs"
      >
        delete
      </button>
    </div>
  </div>
  <div class="va-img-set">
    {% for fig in figs %}
    <div class="img-set-item" setFigId="{{fig.id}}">
      <div>
        <a href="{{fig.url}}" data-lightbox="sample-img">
          <img class="va-img" src="{{fig.url}}" />
        </a>
      </div>
      {% if isProvider %}
      <div>
        <button figId="{{fig.id}}" class="delete-img-btn btn btn-danger btn-xs">
          delete
        </button>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% if isProvider %}
  <div>
    <button
      id="add-fig-btn"
      class="btn btn-sm btn-success"
      figNum="{{leftFigNum}}"
    >
      Add Photos
    </button>
  </div>
  {% endif %}
</div>

<div class="va-img-upload">
  <form
    action="{{ url_for('data.upload_img', data_id=data.id) }}"
    id="my-dropzone"
    class="dropzone"
    method="POST"
    enctype="multipart/form-data"
  ></form>
  <button id="upload-btn" class="btn btn-warning">Confirm</button>
</div>

<div class="variety-view">
  <div class="bd-callout bd-callout-info">
    <span>Data information</span>
  </div>
  <table class="table table-bordered">
    <tbody>
      <tr>
        <th scope="row">Data Type</th>
        <td>{{data.type}}</td>
      </tr>
      <tr>
        <th scope="row">Scientific Name</th>
        <td>{{data.scientific_name}}</td>
      </tr>
      <tr>
        <th scope="row">Tissue</th>
        <td>{{data.tissue}}</td>
      </tr>
      <tr>
        <th scope="row">Age</th>
        <td>{{data.age}}</td>
      </tr>
      <tr>
        <th scope="row">Phenotype</th>
        <td>{{data.bulked_segregant}}</td>
      </tr>
      <tr>
        <th scope="row">Pooled Sample</th>
        <td>{{data.mixed_sample}}</td>
      </tr>
      <tr>
        <th scope="row">DOI</th>
        <td>{{data.dol}}</td>
      </tr>
      <tr>
        <th scope="row">Provider</th>
        <td>
          <a href="{{url_for( 'data.users', username=data.provider)}}"
            >{{data.provider}}</a
          >
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="comment-input">
  {% if isAnonymous %}
  <form method="post" action="">
    <textarea
      cols="30"
      rows="5"
      class="form-control"
      placeholder="Login to comment or reply."
      disabled
    ></textarea>
    <div class="form-group" style="text-align: right; margin-top: 10px">
      <button
        class="btn btn-primary disabled"
        type="submit"
        value="Add Comment"
      >
        Add
      </button>
    </div>
  </form>
  {% else %}
  <form
    method="post"
    action="{{ url_for('data.dataDetail', tc_id=data.tc_id) }}"
  >
    {{ form.csrf_token }} {{ form.content(class="form-control") }}
    <div class="form-group" style="text-align: right; margin-top: 10px">
      <button class="btn btn-primary" type="submit" value="Add">
        Add Comment
      </button>
    </div>
  </form>
  {% endif %}
</div>

<div class="comment-region">
  <div class="bd-callout bd-callout-success">
    <span>Comments</span
    ><span class="comment-number">{{ comments |length}}</span>
  </div>
  {% for comm_i in comments %}
  <div class="comment-body">
    <div class="comment-top">
      <div class="comment-author">
        <p>
          <a href="{{url_for( 'data.users', username=comm_i.provider_name)}}"
            >{{ comm_i.provider_name }}</a
          >
        </p>
      </div>
      <div class="comment-time">
        <p>{{ comm_i.create_time }}</p>
      </div>
    </div>
    <div class="comment-content">
      <p>{{comm_i.content}}</p>
    </div>
    {% if not isAnonymous %}
    <div class="comment-back">
      <button
        class="comment-back-btn"
        id="{{ url_for('variety.reply', commentId=comm_i.id) }}"
      >
        <span class="glyphicon glyphicon-comment"></span>
        Reply
      </button>
    </div>
    {% endif %} {% for reply_i in comm_i.reply %}
    <div class="reply-region">
      <div class="reply-body">
        <div class="reply-top">
          <div class="reply-author">
            <p>
              <a
                href="{{url_for( 'data.users', username=reply_i.provider_name)}}"
                >{{ reply_i.provider_name }}</a
              >
            </p>
          </div>
          <div class="reply-time">
            <p>{{ reply_i.create_time }}</p>
          </div>
        </div>
        <div class="reply-content">
          <p>{{reply_i.content}}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>
{% endblock %} {% block js %}
<script src="{{ url_for('static', filename='js/dropzone.js') }}"></script>
<script src="{{ url_for('static', filename='js/lightbox.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/reply.js') }}"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}
